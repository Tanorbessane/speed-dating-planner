# Story 3.4: Documentation CLI et Guide Utilisateur

## Status

**Draft**

---

## Story

**As a** utilisateur final,
**I want** une documentation complète sur l'utilisation de la CLI,
**so that** je peux facilement installer et utiliser l'outil pour mes événements.

---

## Acceptance Criteria

1. Le `README.md` est mis à jour avec section "Utilisation CLI" complète
2. La section CLI inclut :
   - Commande d'installation
   - Exemples d'utilisation (minimal, complet, avec options)
   - Description de tous les arguments
   - Exemples de sortie console
   - Gestion des erreurs courantes
3. Un fichier `docs/user-guide.md` contient guide utilisateur détaillé :
   - Introduction au problème
   - Cas d'usage typiques
   - Tutoriel étape par étape
   - FAQ
4. Un fichier `examples/cli_examples.sh` contient scripts exemples commentés
5. Les docstrings de `src/cli.py` sont complètes (Google style)
6. Le fichier `pyproject.toml` définit point d'entrée console script :
   ```toml
   [tool.poetry.scripts]
   speed-dating-planner = "src.cli:main"
   ```

---

## Tasks / Subtasks

- [ ] **Task 1: Mettre à jour README.md - Section CLI** (AC: 1, 2)
  - [ ] Ajouter section "## Utilisation CLI"
  - [ ] Sous-section "Installation":
    ```bash
    # Avec Poetry
    poetry install
    poetry run python -m src.cli --help

    # Avec pip
    pip install -e .
    speed-dating-planner --help
    ```
  - [ ] Sous-section "Exemple minimal":
    ```bash
    speed-dating-planner -n 30 -t 5 -c 6 -s 6
    ```
  - [ ] Sous-section "Exemple complet":
    ```bash
    speed-dating-planner \
      --participants 100 \
      --tables 20 \
      --capacity 5 \
      --sessions 10 \
      --output planning_event.json \
      --format json \
      --seed 42 \
      --verbose
    ```
  - [ ] Sous-section "Arguments disponibles" (tableau)
  - [ ] Sous-section "Exemple de sortie" (copie output console)
  - [ ] Sous-section "Erreurs courantes":
    - Configuration invalide (capacité insuffisante)
    - Fichier non accessible en écriture
    - Arguments manquants

- [ ] **Task 2: Créer docs/user-guide.md** (AC: 3)
  - [ ] Section 1: Introduction
    - Problème: organisation événements networking/speed dating
    - Solution: plannings optimisés équitables
  - [ ] Section 2: Démarrage rapide
    - Installation
    - Premier planning (N=30)
    - Interprétation des métriques
  - [ ] Section 3: Cas d'usage
    - Petit événement (N=30)
    - Événement moyen (N=100)
    - Grand événement (N=300)
  - [ ] Section 4: Comprendre les paramètres
    - N (participants)
    - X (tables)
    - x (capacité)
    - S (sessions)
    - Relation mathématique: X × x ≥ N
  - [ ] Section 5: Interpréter les métriques
    - Paires uniques: nombre total rencontres différentes
    - Répétitions: paires rencontrées plusieurs fois
    - Équité: écart max-min (objectif ≤1)
  - [ ] Section 6: FAQ
    - "Quelle est la configuration optimale ?"
    - "Comment minimiser les répétitions ?"
    - "Combien de sessions recommandées ?"
    - "Que faire si configuration impossible ?"

- [ ] **Task 3: Créer examples/cli_examples.sh** (AC: 4)
  - [ ] Script bash avec exemples commentés:
    ```bash
    #!/bin/bash
    # Exemples d'utilisation CLI pour événements types

    # Exemple 1: Petit événement (30 personnes, 6 sessions)
    echo "=== Petit événement ==="
    speed-dating-planner -n 30 -t 5 -c 6 -s 6 -o petit_event.csv

    # Exemple 2: Événement moyen (100 personnes)
    echo "=== Événement moyen ==="
    speed-dating-planner -n 100 -t 20 -c 5 -s 10 -o moyen_event.json -f json

    # Exemple 3: Grand événement avec verbose
    echo "=== Grand événement ==="
    speed-dating-planner -n 300 -t 60 -c 5 -s 15 -o grand_event.csv -v

    # Exemple 4: Seed personnalisé pour reproductibilité
    echo "=== Reproductibilité ==="
    speed-dating-planner -n 50 -t 10 -c 5 -s 8 --seed 12345
    ```
  - [ ] Rendre exécutable: `chmod +x examples/cli_examples.sh`

- [ ] **Task 4: Compléter docstrings cli.py** (AC: 5)
  - [ ] Docstring parse_args():
    - Description: "Parse arguments ligne de commande CLI"
    - Returns: Namespace avec args
    - Example usage
  - [ ] Docstring main():
    - Description: "Point d'entrée principal CLI"
    - Returns: Exit code (0=succès, 1=config invalide, 2=I/O erreur, 3=inattendu)
    - Example: "python -m src.cli -n 30 -t 5 -c 6 -s 6"

- [ ] **Task 5: Configurer console script pyproject.toml** (AC: 6)
  - [ ] Éditer `pyproject.toml`
  - [ ] Ajouter section:
    ```toml
    [tool.poetry.scripts]
    speed-dating-planner = "src.cli:main"
    ```
  - [ ] Tester installation:
    ```bash
    poetry install
    speed-dating-planner --help
    ```

- [ ] **Task 6: Créer examples/README.md CLI** (AC: 4)
  - [ ] Décrire exemples disponibles:
    - basic_usage.py: Exemple Python API
    - advanced_usage.py: Comparaison baseline vs optimisé
    - cli_examples.sh: Exemples CLI bash

- [ ] **Task 7: Tester documentation** (AC: 1, 2, 3, 4)
  - [ ] Vérifier README.md section CLI complète
  - [ ] Vérifier user-guide.md lisible et exhaustif
  - [ ] Exécuter cli_examples.sh et vérifier succès
  - [ ] Tester console script: `speed-dating-planner --help`

- [ ] **Task 8: Créer QA Gate YAML**
  - [ ] Créer `docs/qa/gates/3.4-documentation-cli.yml`

---

## Dev Notes

### Dépendance

**Epic 1-2 + Stories 3.1-3.3:**
- Pipeline complet
- Exporteurs
- CLI fonctionnelle

Cette story **documente** l'utilisation finale du produit.

### Structure Documentation CLI

**README.md:**
- Installation (Poetry + pip)
- Utilisation CLI (exemples)
- Arguments disponibles
- Erreurs courantes

**docs/user-guide.md:**
- Guide détaillé utilisateur final
- Cas d'usage typiques
- FAQ

**examples/cli_examples.sh:**
- Scripts bash prêts à l'emploi
- Commentés pour apprentissage

### Console Script vs Module

**Après installation:**
```bash
# Méthode 1: Module Python
python -m src.cli -n 30 -t 5 -c 6 -s 6

# Méthode 2: Console script (plus user-friendly)
speed-dating-planner -n 30 -t 5 -c 6 -s 6
```

**Configuration pyproject.toml:**
```toml
[tool.poetry.scripts]
speed-dating-planner = "src.cli:main"
```

Après `poetry install`, commande `speed-dating-planner` disponible globalement.

### Exemple Output Console

```
==========================================================================
PLANNING GÉNÉRÉ AVEC SUCCÈS
==========================================================================
Configuration : 30 participants, 5 tables, capacité 6, 6 sessions

Métriques de qualité :
  • Paires uniques créées    : 145
  • Répétitions              : 7
  • Rencontres par personne  : min=10, max=11, moyenne=10.5
  • Équité (écart max-min)   : 1 ✓
==========================================================================

✓ Planning exporté vers : planning.csv
```

---

## Testing

### Validation Documentation

**1. README section CLI présente**
```bash
grep -q "Utilisation CLI" README.md && echo "✓ Section présente"
```

**2. User guide complet**
```bash
test -f docs/user-guide.md && echo "✓ User guide créé"
```

**3. CLI examples exécutable**
```bash
bash examples/cli_examples.sh
# Doit créer fichiers petit_event.csv, moyen_event.json, etc.
```

**4. Console script fonctionnel**
```bash
poetry install
speed-dating-planner --help | grep "participants"
# Doit afficher aide en français
```

---

## QA Gate

**Fichier:** `docs/qa/gates/3.4-documentation-cli.yml`

```yaml
story: 3.4-documentation-cli
checks:
  - name: README CLI Section
    command: grep -q "Utilisation CLI" README.md && echo "✓ Section présente"
    expected: Section présente

  - name: User Guide Exists
    command: test -f docs/user-guide.md && echo "✓ User guide créé"
    expected: File exists

  - name: CLI Examples Executable
    command: bash examples/cli_examples.sh 2>&1 | head -n 5
    expected: Scripts run without error

  - name: Console Script Help
    command: poetry run speed-dating-planner --help | grep "participants"
    expected: French help displayed

  - name: Docstrings Complete
    command: grep -A 5 "def main" src/cli.py | grep -q "Exit code"
    expected: Docstring documented

  - name: Pyproject Console Script
    command: grep -q "speed-dating-planner" pyproject.toml
    expected: Console script configured
```

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-10 | 1.0 | Story initiale créée par Scrum Master | Bob (SM) |

---

**Definition of Done:**
- [ ] README.md section "Utilisation CLI" complète
- [ ] docs/user-guide.md créé (intro, démarrage, cas usage, FAQ)
- [ ] examples/cli_examples.sh créé et exécutable
- [ ] Docstrings src/cli.py complètes (Google style)
- [ ] pyproject.toml: console script `speed-dating-planner` configuré
- [ ] Console script testé et fonctionnel
- [ ] CLI examples s'exécutent sans erreur
- [ ] QA Gate YAML créé
- [ ] **Granularité:** 1 story = 1 PR (documentation CLI)
